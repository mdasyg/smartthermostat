<% provide(:title, 'Device Overview') %>

<div class="well">
  <h1>Overview</h1>
  <h1>
    <small><%= @device.name %> @  <%= @device.location %></small>
  </h1>
</div>

<!-- STATUS -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Status</h3>
  </div>
  <div class="panel-body">
    <div>
      <strong>Last contact at:</strong>
      <%= @device.last_contact_at.nil? ? 'No contact yet' : @device.last_contact_at %>
    </div>
  </div>
</div>

<!-- DEVICE ATTRIBUTES -->
<% if @device.device_attributes.any? %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Device Attributes</h3>
      <button type="button" class="btn btn-default" aria-label="Left Align">
        <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
      </button>
    </div>
    <div class="panel-body">

      <div class="row">
        <div class="col-xs-2">
          <div class="form-group">
            <%= label DeviceAttribute, :name, 'Prop Name' %>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="form-group">
            <%= label DeviceAttribute, :value_type_id %>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="form-group">
            <%= label DeviceAttribute, :min_value %>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="form-group">
            <%= label DeviceAttribute, :max_value %>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="form-group">
            <%= label DeviceAttribute, :set_value %>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="form-group">
            <%= label DeviceAttribute, :current_value %>
          </div>
        </div>
      </div>

      <% @device.device_attributes.each do |device_attribute| %>

        <div class="row">

          <div class="col-xs-2">
            <div class="form-group">
              <%= device_attribute.name %>
            </div>
          </div>

          <div class="col-xs-2">
            <div class="form-group">
            </div>
          </div>

          <div class="col-xs-2">
            <div class="form-group">
              <%= device_attribute.min_value.nil? ? '-' : device_attribute.min_value %>
            </div>
          </div>

          <div class="col-xs-2">
            <div class="form-group">
              <%= device_attribute.max_value.nil? ? '-' : device_attribute.max_value %>
            </div>
          </div>

          <div class="col-xs-2">
            <div class="form-group">
              <% params = ActiveSupport::JSON.encode({ device_uid: device_attribute.device_uid.to_s }) %>
              <a href="#" class="editable-device-attribute-set-value" data-params="<%= params %>" data-pk="<%= device_attribute.id %>" data-name="set_value" data-url="<%= url_for(action: 'update_device_attribute_value', controller: '/devices') %>">
                <%= device_attribute.set_value.nil? ? '-' : device_attribute.set_value %>
              </a>
            </div>
          </div>

          <div class="col-xs-2">
            <div class="form-group">
              <%= device_attribute.current_value.nil? ? '-' : device_attribute.current_value %>
            </div>
          </div>

        </div>
      <% end %>
    </div>
  </div>
<% end %>

<!-- SYSTEM INFO FOR DEVICE -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">System info for device</h3>
  </div>
  <div class="panel-body">

    <% if !@device.description.empty? %>
      <div>
        <strong>Description:</strong>
        <%= @device.description %>
      </div>
    <% end %>

    <div>
      <strong>Serial No:</strong>
      <%= @device.uid %>
    </div>

    <div>
      <strong>Access token:</strong>
      <%= @device.access_token %>
    </div>

  </div>
</div>

<!--INFO FROM DEVICE-->
<% if @device.device_stats.any? %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Device info</h3>
    </div>

    <div class="panel-body">

      <% @device.device_stats.each do |stat| %>

        <div class="row">

          <div class="col-xs-3">
            <%= stat.stat_name %>:
          </div>

          <div class="col-xs-3">
            <%= stat.value %>
          </div>

          <div class="col-xs-3">
            <%= stat.last_update_at %>
          </div>

          <div class="col-xs-3">
            <%= stat.label %>
          </div>

        </div>

      <% end %>

    </div>
  </div>
<% end %>

<!--DEVICE'S SCHEDULES-->
<% if @device.schedule_events.any? %>
  <div class="panel panel-default">

    <div class="panel-heading">
      <h3 class="panel-title">Device's schedules</h3>
    </div>

    <div class="panel-body">
      <%= @device.schedule_events.inspect %>
    </div>

  </div>
<% end %>

<%= link_to 'Edit', edit_device_path(@device) %> |
<%= link_to 'Back', devices_path %>
